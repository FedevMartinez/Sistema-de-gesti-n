@page "/productos/create"
@using Microsoft.AspNetCore.Components.Forms
@using SistemaGestion
@using System.ComponentModel.DataAnnotations
@inject Services.ProductoService ProductoService

<h3>Nuevo Producto</h3>

<EditForm Model="@producto" OnValidSubmit="GuardarAsync" FormName="ProductoForm">

    <div class="row">
        <!-- Descripción -->
        <div class="col-md-6 mb-3">
            <label class="form-label">Descripción</label>
            <InputText class="form-control" @bind-Value="producto.Descripcion" />

        </div>

        <!-- Cantidad -->
        <div class="col-md-3 mb-3">
            <label class="form-label">Cantidad</label>
            <InputNumber class="form-control" @bind-Value="producto.Cantidad" />
        </div>

        <!-- Fecha de ingreso -->
        <div class="col-md-3 mb-3">
            <label class="form-label">Fecha de ingreso</label>
            <InputDate class="form-control" @bind-Value="producto.FechaIngreso" />
        </div>
    </div>

    <div class="row">
        <!-- Costos -->
        <div class="col-md-3 mb-3">
            <label class="form-label">Costo (Pesos)</label>
            <InputNumber class="form-control" @bind-Value="producto.CostoPesos" />
        </div>

        <div class="col-md-3 mb-3">
            <label class="form-label">Costo (Dólar)</label>
            <InputNumber class="form-control" @bind-Value="producto.CostoDolar" />
        </div>

        <!-- Valores de venta -->
        <div class="col-md-3 mb-3">
            <label class="form-label">Valor Venta (Pesos)</label>
            <InputNumber class="form-control" @bind-Value="producto.ValorPesos" />
        </div>

        <div class="col-md-3 mb-3">
            <label class="form-label">Valor Venta (Dólar)</label>
            <InputNumber class="form-control" @bind-Value="producto.ValorDolar" />
        </div>
    </div>

    <div class="row">
        <!-- Fecha compra y valor dólar en el momento -->
        <div class="col-md-4 mb-3">
            <label class="form-label">Fecha de compra</label>
            <InputDate class="form-control" @bind-Value="producto.FechaCompra" />
        </div>

        <div class="col-md-4 mb-3">
            <label class="form-label">Valor dólar al momento</label>
            <InputNumber class="form-control" @bind-Value="producto.ValorDolarMomentoCompra" />
        </div>

        <!-- Subcategoría -->
        <div class="col-md-4 mb-3">
            <label class="form-label">Subcategoría</label>
            <InputNumber class="form-control" @bind-Value="producto.SubCategoriaId" />
        </div>
    </div>

    <div class="row">
        <!-- Cliente o proveedor -->
        <div class="col-md-6 mb-3">
            <label class="form-label">Cliente / Proveedor ID</label>
            <InputNumber class="form-control" @bind-Value="producto.ClienteProveedorId" />
        </div>
    </div>


    <button class="btn btn-primary" type="submit">Guardar</button>
    <button type="button" class="btn btn-secondary" @onclick="Cancelar">Cancelar</button>

</EditForm>

@code {
    private ProductoViewModel producto = new();

    [Parameter] public EventCallback OnSaved { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }

    private async Task GuardarAsync()
    {
        await ProductoService.CreateAsync(producto);
        await OnSaved.InvokeAsync();
    }


    private async Task Cancelar()
    {
        await OnCancel.InvokeAsync();
    }
}